'use client'
import { useEffect, useState } from 'react'
import { createClientComponentClient } from '@supabase/auth-helpers-nextjs'

export type LangCode = 'en' | 'fr' | 'ar'

const translations: Record<LangCode, Record<string, string>> = {
  en: {

    vouchers: 'Vouchers',
  search: 'Search',
  date: 'Date',
  newestFirst: 'Newest first',
  oldestFirst: 'Oldest first',
  status: 'Status',
  store: 'Store',
  buyer: 'Buyer',
  recipient: 'Recipient',
  balance: 'Balance',
  created: 'Created',
  all: 'All',
  blank: 'Blank',
  active: 'Active',
  redeemed: 'Redeemed',
  expired: 'Expired',
  void: 'Void',
  loadingVouchers: 'Loading vouchers...',
  noVouchers: 'No vouchers found.',
  createBlankVouchers: 'Create Blank Vouchers',
  howMany: 'How many?',
  createVouchers: 'Create Vouchers',
  creating: 'Creatingâ€¦',
  noResults: 'No results',
  eachVoucherHint: 'Each voucher will be assigned a unique QR code automatically.',
  prev: 'Prev',
  next: 'Next',
  pageOf: 'Page {{page}} of {{total}}',
 // --- Store Dashboard ---
  loadingDashboard: 'Loading store dashboardâ€¦',
  voucherOverview: 'Voucher Overview',
  financialSummary: 'Financial Summary',
  clientOverview: 'Client Overview',
  total: 'Total',
  
  totalValue: 'Total Value',
  redeemedValue: 'Redeemed Value',
  totalClients: 'Total Clients',
  seeAll: 'See all',    
searchPlaceholder: 'Search by name or address...',
sort: 'Sort',

open: 'Open',
closed: 'Closed',
wilaya: 'Wilaya',
allWilayas: 'All wilayas',
loadingStores: 'Loading stores...',
noStores: 'No stores found.',
name: 'Name',
phone: 'Phone',
address: 'Address',
actions: 'Actions',
view: 'View',
addStoreTitle: 'Add New Store',
addStoreDesc: 'Fill in the store details below.',
cancel: 'Cancel',
addStore: 'Add Store',
saving: 'Savingâ€¦',
storeName: 'Store name *',
email: 'Email *',
wilayaRange: 'Wilaya (1â€“58)',
unnamed: 'Unnamed',
noAddress: 'No address',
none: 'â€”',
    settings: 'Settings',
    profile: 'Profile',
    password: 'Password',
    language: 'Language',
    roles: 'Roles',
    logout: 'Logout',
    darkMode: 'Dark Mode',
    save: 'Save',
    confirm: 'Confirm',
    chooseLang: 'Choose your preferred language:',
    managePref: 'Manage your profile and preferences',
    dashboard: 'Dashboard',
    stores: 'Stores',
    users: 'Users',
    back: 'Back',
    // Add to each language object
totalRegistered: 'Total registered',
allVouchers: 'All vouchers',

currentlyActive: 'Currently active',
usedVouchers: 'Used vouchers',
latestStores: 'Latest Stores',
recentVouchers: 'Recent Vouchers',
topStores: 'Top Performing Stores',
noActiveVouchers: 'No active vouchers found.',
viewAll: 'View all',
searchVouchers: 'Search vouchers by code or buyerâ€¦',
noVouchersFound: 'No vouchers found.',
code: 'Code',
initial: 'Initial',

page: 'Page',
of: 'of',
numberToCreate: 'Number to create',
create: 'Create',
errorCreatingVouchers: 'Error creating vouchers',
vouchersCreated: 'vouchers created successfully',


  },
  fr: {

    vouchers: 'Bons',
  search: 'Rechercher',
  date: 'Date',
  newestFirst: 'Les plus rÃ©cents',
  oldestFirst: 'Les plus anciens',
  status: 'Statut',
  store: 'Magasin',
  buyer: 'Acheteur',
  recipient: 'BÃ©nÃ©ficiaire',
  balance: 'Solde',
  created: 'CrÃ©Ã© le',
  all: 'Tous',
  blank: 'Vierge',
  active: 'Actif',
  redeemed: 'UtilisÃ©',
  expired: 'ExpirÃ©',
  void: 'AnnulÃ©',
  loadingVouchers: 'Chargement des bons...',
  noVouchers: 'Aucun bon trouvÃ©.',
  createBlankVouchers: 'CrÃ©er des bons vierges',
  howMany: 'Combien ?',
  createVouchers: 'CrÃ©er les bons',
  creating: 'CrÃ©ationâ€¦',
  noResults: 'Aucun rÃ©sultat',
  eachVoucherHint: 'Chaque bon aura un code QR unique automatiquement.',
  prev: 'PrÃ©cÃ©dent',
  next: 'Suivant',
  pageOf: 'Page {{page}} sur {{total}}',
    loadingDashboard: 'Chargement du tableau de bord du magasinâ€¦',
  voucherOverview: 'AperÃ§u des bons',
  financialSummary: 'RÃ©sumÃ© financier',
  clientOverview: 'AperÃ§u des clients',
  total: 'Total',

  totalValue: 'Valeur totale',
  redeemedValue: 'Valeur utilisÃ©e',
  totalClients: 'Clients totaux',
  seeAll: 'Voir tout',
    searchVouchers: 'Rechercher un bon par code ou acheteurâ€¦',
noVouchersFound: 'Aucun bon trouvÃ©.',
code: 'Code',
initial: 'Montant initial',

page: 'Page',
of: 'sur',
numberToCreate: 'Nombre Ã  crÃ©er',
create: 'CrÃ©er',
errorCreatingVouchers: 'Erreur lors de la crÃ©ation des bons',
vouchersCreated: 'bons crÃ©Ã©s avec succÃ¨s',

    // ğŸ‡«ğŸ‡· French
searchPlaceholder: 'Rechercher par nom ou adresse...',
sort: 'Trier',
open: 'Ouvert',
closed: 'FermÃ©',
wilaya: 'Wilaya',
allWilayas: 'Toutes les wilayas',
loadingStores: 'Chargement des magasins...',
noStores: 'Aucun magasin trouvÃ©.',
name: 'Nom',
phone: 'TÃ©lÃ©phone',
address: 'Adresse',
actions: 'Actions',
view: 'Voir',
addStoreTitle: 'Ajouter un magasin',
addStoreDesc: 'Remplissez les informations du magasin ci-dessous.',
cancel: 'Annuler',
addStore: 'Ajouter',
saving: 'Enregistrementâ€¦',
storeName: 'Nom du magasin *',
email: 'Email *',
wilayaRange: 'Wilaya (1â€“58)',
unnamed: 'Sans nom',
noAddress: 'Pas dâ€™adresse',
none: 'â€”',

    viewAll: 'Voir tout',
    settings: 'ParamÃ¨tres',
    profile: 'Profil',
    password: 'Mot de passe',
    language: 'Langue',
    roles: 'RÃ´les',
    logout: 'Se dÃ©connecter',
    darkMode: 'Mode sombre',
    save: 'Enregistrer',
    confirm: 'Confirmer',
    chooseLang: 'Choisissez votre langue prÃ©fÃ©rÃ©e :',
    managePref: 'GÃ©rez votre profil et vos prÃ©fÃ©rences',
    dashboard: 'Tableau de bord',
    stores: 'Magasins',
    users: 'Utilisateurs',
    back: 'Retour',
    // ğŸ‡«ğŸ‡· French
totalRegistered: 'Nombre total',
allVouchers: 'Tous les bons',

currentlyActive: 'Actuellement actifs',
usedVouchers: 'Bons utilisÃ©s',
latestStores: 'Derniers magasins',
recentVouchers: 'Bons rÃ©cents',
topStores: 'Magasins les plus performants',
noActiveVouchers: 'Aucun bon actif trouvÃ©.',


  },
  ar: {
      vouchers: 'Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
  search: 'Ø¨Ø­Ø«',
  date: 'Ø§Ù„ØªØ§Ø±ÙŠØ®',
  newestFirst: 'Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹',
  oldestFirst: 'Ø§Ù„Ø£Ù‚Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹',
  status: 'Ø§Ù„Ø­Ø§Ù„Ø©',
  store: 'Ø§Ù„Ù…ØªØ¬Ø±',
  buyer: 'Ø§Ù„Ù…Ø´ØªØ±ÙŠ',
  recipient: 'Ø§Ù„Ù…Ø³ØªÙÙŠØ¯',
  balance: 'Ø§Ù„Ø±ØµÙŠØ¯',
  created: 'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡',
  all: 'Ø§Ù„ÙƒÙ„',
  blank: 'ÙØ§Ø±ØºØ©',
  active: 'Ù†Ø´Ø·Ø©',
  redeemed: 'Ù…Ø³ØªØ¹Ù…Ù„Ø©',
  expired: 'Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©',
  void: 'Ù…Ù„ØºØ§Ø©',
  loadingVouchers: 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…...',
  noVouchers: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ø³Ø§Ø¦Ù….',
  createBlankVouchers: 'Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ø§Ø¦Ù… ÙØ§Ø±ØºØ©',
  howMany: 'ÙƒÙ… Ø¹Ø¯Ø¯Ù‡Ø§ØŸ',
  createVouchers: 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
  creating: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡â€¦',
  noResults: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬',
  eachVoucherHint: 'Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø±Ù…Ø² QR ÙØ±ÙŠØ¯ Ù„ÙƒÙ„ Ù‚Ø³ÙŠÙ…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.',
  prev: 'Ø§Ù„Ø³Ø§Ø¨Ù‚',
  next: 'Ø§Ù„ØªØ§Ù„ÙŠ',
  pageOf: 'Ø§Ù„ØµÙØ­Ø© {{page}} Ù…Ù† {{total}}',
    loadingDashboard: 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±â€¦',
    voucherOverview: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
    financialSummary: 'Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø§Ù„ÙŠ',
    clientOverview: 'Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
    total: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
    
    totalValue: 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©',
    redeemedValue: 'Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©',
    totalClients: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
    seeAll: 'Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„',
    searchVouchers: 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø³ÙŠÙ…Ø© Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø±Ù…Ø² Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠâ€¦',
    noVouchersFound: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø³Ø§Ø¦Ù….',
    code: 'Ø§Ù„Ø±Ù…Ø²',
    initial: 'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ',
    
    page: 'ØµÙØ­Ø©',
    of: 'Ù…Ù†',
    numberToCreate: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ù†Ø´Ø§Ø¤Ù‡Ø§',
    create: 'Ø¥Ù†Ø´Ø§Ø¡',
    errorCreatingVouchers: 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
    vouchersCreated: 'ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù… Ø¨Ù†Ø¬Ø§Ø­',
    viewAll: 'Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„',
    settings: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
    profile: 'Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ',
    password: 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±',
    language: 'Ø§Ù„Ù„ØºØ©',
    roles: 'Ø§Ù„Ø£Ø¯ÙˆØ§Ø±',
    logout: 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬',
    darkMode: 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ',
    save: 'Ø­ÙØ¸',
    confirm: 'ØªØ£ÙƒÙŠØ¯',
    cancel: 'Ø¥Ù„ØºØ§Ø¡',
    chooseLang: 'Ø§Ø®ØªØ± Ù„ØºØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø©:',
    managePref: 'Ù‚Ù… Ø¨Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙÙƒ ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©',
    dashboard: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
    stores: 'Ø§Ù„Ù…ØªØ§Ø¬Ø±',
    users: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†',
    back: 'Ø±Ø¬ÙˆØ¹',
    totalRegistered: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†',
    allVouchers: 'ÙƒÙ„ Ø§Ù„Ù‚Ø³Ø§Ø¦Ù…',
    currentlyActive: 'Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠÙ‹Ø§',
    usedVouchers: 'Ù‚Ø³Ø§Ø¦Ù… Ù…Ø³ØªØ®Ø¯Ù…Ø©',
    latestStores: 'Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ØªØ§Ø¬Ø±',
    recentVouchers: 'Ø§Ù„Ù‚Ø³Ø§Ø¦Ù… Ø§Ù„Ø­Ø¯ÙŠØ«Ø©',
    topStores: 'Ø£ÙØ¶Ù„ Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø£Ø¯Ø§Ø¡Ù‹',
    noStores: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØªØ§Ø¬Ø± Ø¨Ø¹Ø¯.',
    noActiveVouchers: 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ø³Ø§Ø¦Ù… Ù†Ø´Ø·Ø©.',
    searchPlaceholder: 'Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†...',
    sort: 'ØªØ±ØªÙŠØ¨',
    
    open: 'Ù…ÙØªÙˆØ­',
    closed: 'Ù…ØºÙ„Ù‚',
    wilaya: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ©',
    allWilayas: 'ÙƒÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª',
    loadingStores: 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±...',
    name: 'Ø§Ù„Ø§Ø³Ù…',
    phone: 'Ø§Ù„Ù‡Ø§ØªÙ',
    address: 'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†',
    actions: 'Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª',
    view: 'Ø¹Ø±Ø¶',
    addStoreTitle: 'Ø¥Ø¶Ø§ÙØ© Ù…ØªØ¬Ø± Ø¬Ø¯ÙŠØ¯',
    addStoreDesc: 'Ø§Ù…Ù„Ø£ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØªØ¬Ø± Ø£Ø¯Ù†Ø§Ù‡.',
    addStore: 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØªØ¬Ø±',
    saving: 'Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦',
    storeName: 'Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø± *',
    email: 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ *',
    wilayaRange: 'Ø§Ù„ÙˆÙ„Ø§ÙŠØ© (1â€“58)',
    unnamed: 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…',
    noAddress: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ÙˆØ§Ù†',
    none: 'â€”',
  },
}

export function useLanguage() {
  const [lang, setLang] = useState<LangCode>('en')
  const supabase = createClientComponentClient()

  useEffect(() => {
    loadLang()
  }, [])

  async function loadLang() {
    try {
      const local = localStorage.getItem('lang') as LangCode | null
      if (local) {
        applyLang(local, false)
        return
      }
      const { data } = await supabase.auth.getUser()
      const userLang = data.user?.user_metadata?.lang as LangCode | undefined
      applyLang(userLang || 'en', false)
    } catch {
      applyLang('en', false)
    }
  }

  function applyLang(code: LangCode, shouldReload = true) {
    setLang(code)
    localStorage.setItem('lang', code)
    document.documentElement.lang = code
    document.documentElement.dir = code === 'ar' ? 'rtl' : 'ltr'

    if (shouldReload) window.location.reload() // âœ… reload page on user action
  }

  return { lang, setLang: (code: LangCode) => applyLang(code, true), t: translations[lang] }
}
